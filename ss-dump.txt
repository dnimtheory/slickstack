#!/bin/bash

####################################################################################################
#### author: SlickStack ############################################################################
#### link: https://slickstack.io ###################################################################
#### mirror: http://mirrors.slickstack.io/ss-dump.txt ##############################################
#### path: /var/www/ss-dump ########################################################################
#### destination: n/a (not a boilerplate) ##########################################################
#### purpose: dumps the live MySQL database to /var/www/wp.sql (SFTP user can access) ##############
#### module version: MySQL 5.7+ ####################################################################
####################################################################################################

## include SlickStack configuration ##
source /var/www/ss-config

####################################################################################################
#### Dump The Live MySQL Database ##################################################################
####################################################################################################

## MESSAGE ##
echo -e "\e[36mDumping the live MySQL database to /var/www/wp.sql for safe-keeping...\e[0m"

## dump MySQL database to /var/www/wp.sql ##
mysqldump --user=root --password="$DB_PASSWORD_ROOT" --host="$DB_HOST" --protocol=tcp --port=3306 --dump-date --flush-privileges --force "$DB_NAME" > /var/www/wp.sql

####################################################################################################
#### Reset Permissions: MySQL Database Dump File ###################################################
####################################################################################################

chown root:root /var/www/wp.sql
chmod 0775 /var/www/wp.sql

####################################################################################################
#### External References Used By SlickStack To Improve This Script #################################
####################################################################################################

## Ref: https://dev.mysql.com/doc/refman/5.7/en/mysqldump.html ##
